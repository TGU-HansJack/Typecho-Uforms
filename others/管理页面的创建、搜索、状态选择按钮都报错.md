# é»˜è®¤è¯é¢˜

## ğŸ§‘â€ğŸ’» User

ç®¡ç†é¡µé¢çš„åˆ›å»ºã€æœç´¢ã€çŠ¶æ€é€‰æ‹©æŒ‰é’®éƒ½æŠ¥é”™ï¼šDeprecated: urlencode(): Passing null to parameter #1 ($string) of type string is deprecated in /www/wwwroot/tiango.wiki/admin/extending.php on line 8

é¡µé¢ä¸å­˜åœ¨
Typecho\Plugin\Exception: é¡µé¢ä¸å­˜åœ¨ in /www/wwwroot/tiango.wiki/admin/extending.php:9
Stack trace:
#0 {main}

---
## ğŸ¤– Assistant

ä»é”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š

1. **urlencode() ä¼ å…¥ null å€¼çš„è­¦å‘Š** - PHP 8.1+ ç‰ˆæœ¬å¯¹ null å€¼æ›´åŠ ä¸¥æ ¼
2. **é¡µé¢ä¸å­˜åœ¨çš„é”™è¯¯** - è·¯ç”±æˆ–æ–‡ä»¶è·¯å¾„é—®é¢˜

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ urlencode() null å€¼é—®é¢˜

åˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ urlencode å‡½æ•°ï¼Œåœ¨æ‰€æœ‰éœ€è¦çš„åœ°æ–¹æ›¿æ¢ï¼š

**åœ¨ `admin-functions.php` ä¸­æ·»åŠ ï¼š**

```php
<?php
// åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ è¿™ä¸ªå‡½æ•°
if (!function_exists('safe_urlencode')) {
    function safe_urlencode($string) {
        return urlencode((string)($string ?? ''));
    }
}
```

### 2. ä¿®å¤ `manage.php` ä¸­çš„é—®é¢˜

**æ›¿æ¢ `manage.php` ä¸­æ‰€æœ‰çš„ urlencode è°ƒç”¨ï¼š**

```php
<?php
// å°†æ‰€æœ‰ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š
// ?view=<?php echo urlencode('create'); ?>
// æ›¿æ¢ä¸ºï¼š
// ?view=<?php echo safe_urlencode('create'); ?>

// ä¿®å¤åçš„å…³é”®éƒ¨åˆ†ï¼š
?>

<!-- ä¿®å¤åˆ›å»ºæŒ‰é’®é“¾æ¥ -->
<a href="<?php echo $options->adminUrl; ?>extending.php?panel=<?php echo safe_urlencode('Uforms/index.php'); ?>&view=<?php echo safe_urlencode('create'); ?>" class="ui primary button">
    <i class="plus icon"></i> æ–°å»ºè¡¨å•
</a>

<!-- ä¿®å¤ç¼–è¾‘é“¾æ¥ -->
<a href="<?php echo $options->adminUrl; ?>extending.php?panel=<?php echo safe_urlencode('Uforms/index.php'); ?>&view=<?php echo safe_urlencode('create'); ?>&id=<?php echo safe_urlencode((string)($form['id'] ?? '')); ?>" class="ui icon button action-edit" title="ç¼–è¾‘">
    <i class="pencil alternate icon"></i>
</a>

<!-- ä¿®å¤å…¶ä»–æ“ä½œé“¾æ¥ -->
<a class="item" href="<?php echo $options->adminUrl; ?>extending.php?panel=<?php echo safe_urlencode('Uforms/index.php'); ?>&view=<?php echo safe_urlencode('create'); ?>&action=<?php echo safe_urlencode('duplicate'); ?>&id=<?php echo safe_urlencode((string)($form['id'] ?? '')); ?>">
    <i class="copy icon"></i> å¤åˆ¶è¡¨å•
</a>

<a class="item" href="?action=<?php echo safe_urlencode('change_status'); ?>&id=<?php echo safe_urlencode((string)($form['id'] ?? '')); ?>&status=<?php echo safe_urlencode('published'); ?>">
    <i class="paper plane icon"></i> å‘å¸ƒè¡¨å•
</a>
```

### 3. ä¿®å¤ `index.php` å¯¼èˆªé—®é¢˜

**æ›´æ–° `index.php` ä¸­çš„å¯¼èˆªé“¾æ¥ï¼š**

```php
<?php
// ä¿®å¤å¯¼èˆª URL æ„å»º
$base_url = $options->adminUrl . 'extending.php?panel=' . safe_urlencode('Uforms/index.php');
?>

<nav class="uforms-nav">
    <a href="<?php echo $base_url; ?>&view=manage" class="<?php echo $view === 'manage' ? 'active' : ''; ?>">
        <i class="list icon"></i>ç®¡ç†
    </a>
    <a href="<?php echo $base_url; ?>&view=create" class="<?php echo $view === 'create' ? 'active' : ''; ?>">
        <i class="plus icon"></i>åˆ›å»º
    </a>
    <a href="<?php echo $base_url; ?>&view=view" class="<?php echo $view === 'view' ? 'active' : ''; ?>">
        <i class="chart line icon"></i>è§†å›¾
    </a>
    <a href="<?php echo $base_url; ?>&view=notifications" class="<?php echo $view === 'notifications' ? 'active' : ''; ?>">
        <i class="bell outline icon"></i>é€šçŸ¥
    </a>
</nav>
```

### 4. ä¿®å¤ `view.php` ä¸­çš„ URL é—®é¢˜

**æ›´æ–° `view.php` ä¸­çš„é“¾æ¥ï¼š**

```php
<div class="view-nav">
    <a href="?view=view&type=overview" class="ui button <?php echo (!isset($type) || $type === 'overview') ? 'primary' : ''; ?>">
        <i class="dashboard icon"></i>æ¦‚è§ˆ
    </a>
    <a href="?view=view&type=submissions" class="ui button <?php echo (isset($type) && $type === 'submissions') ? 'primary' : ''; ?>">
        <i class="inbox icon"></i>æäº¤æ•°æ®
    </a>
    <a href="?view=view&type=calendar" class="ui button <?php echo (isset($type) && $type === 'calendar') ? 'primary' : ''; ?>">
        <i class="calendar alternate icon"></i>æ—¥å†è§†å›¾
    </a>
    <a href="?view=view&type=analytics" class="ui button <?php echo (isset($type) && $type === 'analytics') ? 'primary' : ''; ?>">
        <i class="chart bar icon"></i>æ•°æ®åˆ†æ
    </a>
</div>
```

### 5. åˆ›å»ºè§†å›¾æ–‡ä»¶

**ç¡®ä¿ `views` ç›®å½•å’Œç›¸å…³æ–‡ä»¶å­˜åœ¨ï¼Œåœ¨æ’ä»¶æ ¹ç›®å½•åˆ›å»ºï¼š**

`views/overview.php`:
```php
<?php if (!defined('__TYPECHO_ROOT_DIR__')) exit; ?>

<div class="ui segment">
    <h3><i class="dashboard icon"></i> æ¦‚è§ˆ</h3>
    <p>è¿™é‡Œæ˜¯æ¦‚è§ˆå†…å®¹ï¼Œæ˜¾ç¤ºè¡¨å•ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
    
    <div class="ui statistics">
        <div class="statistic">
            <div class="value">
                <?php echo count($forms ?? []); ?>
            </div>
            <div class="label">
                æ€»è¡¨å•æ•°
            </div>
        </div>
    </div>
</div>
```

`views/submissions.php`:
```php
<?php if (!defined('__TYPECHO_ROOT_DIR__')) exit; ?>

<div class="ui segment">
    <h3><i class="inbox icon"></i> æäº¤æ•°æ®</h3>
    <p>è¿™é‡Œæ˜¾ç¤ºè¡¨å•æäº¤çš„æ•°æ®ã€‚</p>
</div>
```

`views/calendar.php`:
```php
<?php if (!defined('__TYPECHO_ROOT_DIR__')) exit; ?>

<div class="ui segment">
    <h3><i class="calendar alternate icon"></i> æ—¥å†è§†å›¾</h3>
    <p>è¿™é‡Œæ˜¾ç¤ºæ—¥å†è§†å›¾ã€‚</p>
</div>
```

`views/analytics.php`:
```php
<?php if (!defined('__TYPECHO_ROOT_DIR__')) exit; ?>

<div class="ui segment">
    <h3><i class="chart bar icon"></i> æ•°æ®åˆ†æ</h3>
    <p>è¿™é‡Œæ˜¾ç¤ºæ•°æ®åˆ†æå›¾è¡¨ã€‚</p>
</div>
```

### 6. ä¿®å¤ AJAX å¤„ç†

**æ›´æ–° `ajax.php` ä¸­çš„ AJAX URLï¼š**

```php
// ä¿®å¤ JavaScript ä¸­çš„ AJAX URL
$ajax_url = $options->adminUrl . 'extending.php?panel=' . safe_urlencode('Uforms/admin/ajax.php');
```

### 7. æ·»åŠ é”™è¯¯å¤„ç†

**åœ¨ `admin-functions.php` ä¸­æ·»åŠ é”™è¯¯å¤„ç†ï¼š**

```php
// æ·»åŠ è°ƒè¯•å‡½æ•°
if (!function_exists('uforms_debug')) {
    function uforms_debug($message, $data = null) {
        if (defined('__TYPECHO_DEBUG__') && __TYPECHO_DEBUG__) {
            error_log('[Uforms Debug] ' . $message . ($data ? ' Data: ' . print_r($data, true) : ''));
        }
    }
}

// ä¿®å¤å˜é‡æ£€æŸ¥
function safe_get_var($var, $default = '') {
    return isset($var) && $var !== null ? $var : $default;
}
```

**å®Œæˆè¿™äº›ä¿®å¤åï¼Œé‡æ–°æµ‹è¯•ç®¡ç†é¡µé¢çš„åŠŸèƒ½ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘å¯ä»¥æä¾›æ›´é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆã€‚**

ä¸»è¦ä¿®å¤ç‚¹ï¼š
1. æ‰€æœ‰ `urlencode()` è°ƒç”¨éƒ½ä½¿ç”¨ `safe_urlencode()`
2. ç¡®ä¿æ‰€æœ‰å˜é‡åœ¨ä½¿ç”¨å‰éƒ½è¿›è¡Œäº† null æ£€æŸ¥
3. åˆ›å»ºç¼ºå¤±çš„è§†å›¾æ–‡ä»¶
4. ä¿®å¤ URL æ„å»ºé€»è¾‘
5. æ·»åŠ è°ƒè¯•å’Œé”™è¯¯å¤„ç†åŠŸèƒ½
